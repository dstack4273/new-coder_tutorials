---
title: "Part 5: Testing the bot"
layout: post.html
tags: [irc, network, networks]
url: "/~drafts/networks/part-5/"
---

Unit tests for our IRC Bot application.


### Testing our quote_picker module

We’ll create a new file, `test_quote_picker.py` to test our `quote_picker.py` module.

#### Test Module Setup

A few import statements:

```python
import os

from twisted.trial import unittest

from talkback.quote_picker import QuotePicker

# <--snip-->
```

#### TestQuotePicker class

Our TestQuotePicker class inherits Twisted’s `unittest.TestCase` class, which is based off of Python’s `unittest` library, but adds the ability to include Deferreds into our test suite (although deferreds are not needed when simply testing our `QuotePicker`).

When we run our tests, `TestCase` will run  every function that starts with `test`; in this case, it will run `test_pick`:

```python
class TestQuotePicker(unittest.TestCase):
    QUOTE1 = (
        "A fool without fear is sometimes wiser than an angel with fear. "
        "~ Nancy Astor"
    )
    QUOTE2 = (
        "You don't manage people, you manage things. You lead people. "
        "~ Grace Hopper"
    )

    def test_pick(self):
        picker = QuotePicker(
            os.path.join(os.path.dirname(__file__), "test_quotes.txt")
        )
        quote = picker.pick()
        self.assertIn(quote, (self.QUOTE1, self.QUOTE2),
                      "Got unexpected quote: '%s'" % (quote))
```

We define a two constants, `QUOTE1` and `QUOTE2`.  This is when we test our `pick` function on our `test_quotes.txt` file, we can be sure we actually pick a quote.

Only one function is defined in our `quote_picker.py` (not including the init function), `pick`; therefore, we only have one test case, `test_pick`.

Within our `test_pick` function, we will instantiate `QuotePicker`.  Notice that we use the module `os` to grab the `test_quotes.txt` to pass into the `QuotePicker` class.  Rather than hard-coding the path to the quotes file, we take advantage of the `os` standard module to:

1. grab the directory name that the current file is located (`os.path.dirname(__file__)`), and
2. create a string of the path to the `test_quotes.txt` file by joining of the path to the current directory, and the file name itself.

Next, we actually call our `pick` method on the `picker` object we instantiated. 

Lastly, we need to make sure the `pick` function returned what is expected.  Grabbing a quote from the `text_quotes.txt` file at (pseudo-)random should return one of the two quotes we defined earlier.  We check this by using `assertIn` function, where we make sure that the `quote` we picked is one of the two quotes, `QUOTE1` or `QUOTE2`, and if not, to return the message: `"Got unexpected quote: '%s'" % (quote))`.



### Testing our TalkBackBot

Let’s make another file, `test_talkbackbot.py` to test our `bot.py` module.

#### Module Setup

Let’s import some modules from Twisted for our testing, as well as the `TalkBackBotFactory` that we want to test:

```python
from twisted.test import proto_helpers
from twisted.trial import unittest

from talkback.bot import TalkBackBotFactory

# <--snip-->
```

#### FakePicker class


**TODO**

Our final step: [running our bot and the test suite &rarr;]( {{ get_url("/~drafts/networks/part-6/")}})